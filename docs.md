<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [api][1]
    -   [Examples][2]
-   [configureApi][3]
    -   [Parameters][4]
    -   [Examples][5]
-   [configureHttp][6]
    -   [Parameters][7]
    -   [Examples][8]
-   [composeMiddleware][9]
    -   [Parameters][10]
    -   [Examples][11]
-   [http][12]
    -   [Parameters][13]
    -   [Examples][14]
-   [HttpError][15]
    -   [Parameters][16]
    -   [Examples][17]
-   [isAuthenticated][18]
    -   [Parameters][19]
    -   [Examples][20]
-   [getAuthenticationContext][21]
    -   [Examples][22]

## api

A lightweight wrapper around the [http][23] module.
Provides functions to make API requests with specified HTTP methods.

The functions are as follows:

-   `get(url, options)` sends a `'GET'` request
-   `patch(url, body, options)` sends a `'PATCH'` request
-   `post(url, body, options)` sends a `'POST'` request
-   `put(url, body, options)` sends a `'PUT'` request
-   `destroy(url, body, options)` sends a `'DELETE'` request
-   `call(url, method, body, options)` sends a request with specified method

Each function can be passed an `options` object, which will eventually be forwarded
to the [Fetch API][24].

Each function returns a promise, which will either resolve with a response object
or reject with an [HTTPError][25].

### Examples

```javascript
function getUsers () {
  return api.get('/users', { credentials: 'include' })
}

getUsers()
   .then(res => console.log('The users are', res))
   .catch(err => console.log('An error occurred!', err))
```

## configureApi

A function that returns a configured instance of the [api][1] module.
This function's argument will be used as the default config for the returned instance.

Note: This configuration can always be overridden by passing in options manually.

### Parameters

-   `config` **[Object][26]** An api configuration object
-   `baseApi` **[Object][26]?** An existing api instance to extend with the configuration

### Examples

```javascript
const myApi = configureApi({ root: 'http://example.com', mode: 'cors' })

myApi.get('/thing') // A cors request will be made to "http://example.com/thing"
```

Returns **[Object][26]** A configured api instance

## configureHttp

A function that returns a configured instance of the [http][23] module.
This function's argument will be used as the default config for the returned instance.

Note: This configuration can always be overridden by passing in options manually.

### Parameters

-   `config` **[Object][26]** An http configuration object
-   `baseHttp` **[Object][26]?** An existing http instance to extend with the configuration

### Examples

```javascript
const myHttp = configureHttp({ root: 'http://example.com', mode: 'cors' })

myHttp('/thing', { method: 'GET' }) // A cors request will be made to "http://example.com/thing"
```

Returns **[Object][26]** A configured http instance

## composeMiddleware

A utility function that composes multiple request middlewares into a single function.
This can be used to create more complex `before` hooks for [http][23].

### Parameters

-   `middlewares` **...[Function][27]** Functions that receive and return request options

### Examples

```javascript
function addBearerToken () {
   const token = getTokenFromStorage()
   if (token) return { bearerToken: token }
}

function addPathToUrl ({ url }) {
   return {
     url: url + '/some-path'
   }
}

const before = composeMiddleware(
   addBearerToken,
   addPathToUrl,
)

// this will call both middlewares before the request
http('/users', { before })
```

Returns **[Function][27]** A composed middleware function

## http

A wrapper function for the [Fetch API][24]
that adds default request settings and handles CRSF token logic.

This function adds the following config settings to the given request:

    {
      credentials: 'same-origin',
      headers: [
        'Accept': 'application/json',
        'X-Requested-With': 'XMLHttpRequest',
        'Content-Type': 'application/json'
      ],
      mode: 'same-origin'
    }

Any one of these settings can be overriden using the passed-in config object.

In addition to the normal Fetch API settings, the config object may also contain these special settings just for `http`:

-   `url`: The url for the request. This can also be passed in directly as the first argument (see shorthand example).
-   `root`: A path to be appended to the given url (default=`''`).
-   `crsf`: The name of the `meta` tag containing the CSRF token (default=`'csrf-token'`). This can be set to `false` to prevent a token from being sent.
-   `before`: A function that's called before the request executes. This function is passed the request options and its return value will be added to those options.
     It can also return a promise that resolves to a new options object.
-   `bearerToken`: A token to use for bearer auth. If provided, `http` will add the header `"Authorization": "Bearer <bearerToken>"` to the request.
-   `onSuccess`: A function that will be called if the request succeeds. It will be passed the successful response. If it returns a value, `http` will resolve with this value instead of the response.
-   `onFailure`: A function that will be called if the request fails. It will be passed the error that was thrown during the request. If it returns a value, `http` will reject with this value instead of the default error.
-   `successDataPath`: A path to response data that the promise will resolve with.
-   `failureDataPath`: A path to the errors that will be included in the HttpError object (default=`'errors'`)
-   `query`: An object that will be transformed into a query string and appended to the request URL.
-   `overrideHeaders`: A boolean flag indicating whether or not default headers should be included in the request (default=`false`).
-   `camelizeResponse`: A boolean flag indicating whether or not to camelize the response keys (default=`true`). The helper function that does this is also exported from this library as `camelizeKeys`.
-   `decamelizeBody`: A boolean flag indicating whether or not to decamelize the body keys (default=`true`). The helper function that does this is also exported from this library as `decamelizeKeys`.
-   `decamelizeQuery`: A boolean flag indicating whether or not to decamelize the query string keys (default=`true`).
-   `parseJsonStrictly`: A boolean flag indicating whether or not to return the text of the response body if JSON parsing fails (default=`true`). If set to `true` and invalid JSON is received in the response, then `null` will be returned instead.
-   `auth`: An object with the following keys `{ username, password }`. If present, `http` will use [basic auth][28], adding the header `"Authorization": "Basic <authToken>"` to the request, where `<authToken>` is a base64 encoded string of `username:password`.

### Parameters

-   `config` **[Object][26]** An object containing config information for the `Fetch` request, as well as the extra keys noted above.

### Examples

```javascript
function getUsers () {
  return http({
     url: '/users',
     root: 'www.my.cool.api.com',
     crsf: 'custom-token-name'
  })
}

getUsers()
   .then(res => console.log('The users are', res))
   .catch(err => console.log('An error occurred!', err))

// Shorthand: pass `url` as first argument:
function getUsers () {
  return http('/users', options)
}
```

Returns **[Promise][29]** A Promise that either resolves with the response or rejects with an [HttpError][15].

## HttpError

**Extends Error**

An error class that is thrown by the [http][23] module when a request fails.

In addition to the standard [Error][30] attributes, instances of `HttpError` include the following:

-   `status`: the status code of the response
-   `statusText`: the status text of the response
-   `response`: the full response object
-   `message`: A readable error message with format `<status> - <statusText>`

### Parameters

-   `status` **[Number][31]** the status code of the response
-   `statusText` **[String][32]** the status text of the response
-   `response` **[Object][26]** the full response object
-   `errors` **[Object][26]** an object containing error messages associated with the response (optional, default `{}`)

### Examples

```javascript
// Instantiated manually
const MyError = new HttpError(500, 'Something went wrong!')
console.log(MyError.toString()) // "HttpError: 500 - Something went wrong"

// Instantiated by http module
http('/bad-route').catch(err => console.log(err.name)) // -> "HttpError"
```

## isAuthenticated

A helper function to determine if the current user is authenticated.
This function accepts an object argument with a `context` key.

This returns true when the LP Auth Api cookie exists and contains a
token.
If the `context` key is present, this function returns true if the user is
both authenticated and the specified context is present.

Note, this does not **validate** the token, it only checks for
presence, validation must be done on the server.

### Parameters

-   `options` **[Object][26]** config object containing the context (optional, default `{}`)

### Examples

```javascript
// WITHOUT context

// After sign in
isAuthenticated() // true

// After sign out
isAuthenticated() // false

// WITH context

// After an 'admin' signs in
isAuthenticated({ context: 'admin' }) // true

isAuthenticated({ context: 'non-admin' }) // false

// After sign out
isAuthenticated({ context: 'admin' }) // false

isAuthenticated({ context: 'non-admin' }) // false
```

Returns **[Boolean][33]** 

## getAuthenticationContext

A helper function to retrieve the authentication context for the 
authenticated user.

This function returns the context string when the LP Auth Api cookie exists, 
contains a valid token, and contains a context.

This function returns `undefined` when there is no context present,
or if the LP Auth API cookie does not exist.

### Examples

```javascript
// After an 'admin' signs in
getAuthenticationContext() // 'admin'

// After a user with no context signs in
getAuthenticationContext() // undefined 

// After sign out
getAuthenticationContext() // undefined

*
```

Returns **[String][32]** 

[1]: #api

[2]: #examples

[3]: #configureapi

[4]: #parameters

[5]: #examples-1

[6]: #configurehttp

[7]: #parameters-1

[8]: #examples-2

[9]: #composemiddleware

[10]: #parameters-2

[11]: #examples-3

[12]: #http

[13]: #parameters-3

[14]: #examples-4

[15]: #httperror

[16]: #parameters-4

[17]: #examples-5

[18]: #isauthenticated

[19]: #parameters-5

[20]: #examples-6

[21]: #getauthenticationcontext

[22]: #examples-7

[23]: http

[24]: https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API

[25]: HTTPError

[26]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[27]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function

[28]: https://en.wikipedia.org/wiki/Basic_access_authentication#Client_side

[29]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise

[30]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error

[31]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[32]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[33]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean
